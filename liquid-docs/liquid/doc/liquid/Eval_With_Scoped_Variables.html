<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"/><title>3.2.7&nbsp;Eval With Scoped Variables</title><link rel="stylesheet" type="text/css" href="../scribble.css" title="default"/><link rel="stylesheet" type="text/css" href="../racket.css" title="default"/><link rel="stylesheet" type="text/css" href="../manual-style.css" title="default"/><link rel="stylesheet" type="text/css" href="../manual-racket.css" title="default"/><link rel="stylesheet" type="text/css" href="../manual-racket.css" title="default"/><link rel="stylesheet" type="text/css" href="../doc-site.css" title="default"/><script type="text/javascript" src="../scribble-common.js"></script><script type="text/javascript" src="../manual-racket.js"></script><script type="text/javascript" src="../manual-racket.js"></script><script type="text/javascript" src="../doc-site.js"></script><script type="text/javascript" src="file:///usr/share/doc/racket/local-redirect/local-redirect.js"></script><script type="text/javascript" src="file:///home/mordecai/.racket/6.1/doc/local-redirect/local-user-redirect.js"></script><!--[if IE 6]><style type="text/css">.SIEHidden { overflow: hidden; }</style><![endif]--></head><body id="doc-racket-lang-org"><div class="tocset"><div class="tocview"><div class="tocviewlist tocviewlisttopspace"><div class="tocviewtitle"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_0&quot;);">&#9658;</a></td><td></td><td><a href="index.html" class="tocviewlink" data-pltdoc="x">Racket Library Support for LIQUID</a></td></tr></table></div><div class="tocviewsublisttop" style="display: none;" id="tocview_0"><table cellspacing="0" cellpadding="0"><tr><td align="right">1&nbsp;</td><td><a href="About_LIQUID.html" class="tocviewlink" data-pltdoc="x">About LIQUID</a></td></tr><tr><td align="right">2&nbsp;</td><td><a href="Concepts.html" class="tocviewlink" data-pltdoc="x">Concepts</a></td></tr><tr><td align="right">3&nbsp;</td><td><a href="Architecture.html" class="tocviewselflink" data-pltdoc="x">Architecture</a></td></tr><tr><td align="right">4&nbsp;</td><td><a href="Reference.html" class="tocviewlink" data-pltdoc="x">Reference</a></td></tr><tr><td align="right">5&nbsp;</td><td><a href="Examples.html" class="tocviewlink" data-pltdoc="x">Examples</a></td></tr><tr><td align="right">6&nbsp;</td><td><a href="To-Do.html" class="tocviewlink" data-pltdoc="x">To-<wbr></wbr>Do</a></td></tr><tr><td align="right"></td><td><a href="doc-index.html" class="tocviewlink" data-pltdoc="x">Index</a></td></tr></table></div></div><div class="tocviewlist"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_1&quot;);">&#9658;</a></td><td>3&nbsp;</td><td><a href="Architecture.html" class="tocviewlink" data-pltdoc="x">Architecture</a></td></tr></table><div class="tocviewsublist" style="display: none;" id="tocview_1"><table cellspacing="0" cellpadding="0"><tr><td align="right">3.1&nbsp;</td><td><a href="Dataplex.html" class="tocviewlink" data-pltdoc="x">Dataplex</a></td></tr><tr><td align="right">3.2&nbsp;</td><td><a href="Multiple_Execution_Path_Exits_Architecture.html" class="tocviewselflink" data-pltdoc="x">Multiple Execution Path Exits Architecture</a></td></tr></table></div></div><div class="tocviewlist"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_2&quot;);">&#9660;</a></td><td>3.2&nbsp;</td><td><a href="Multiple_Execution_Path_Exits_Architecture.html" class="tocviewlink" data-pltdoc="x">Multiple Execution Path Exits Architecture</a></td></tr></table><div class="tocviewsublistbottom" style="display: block;" id="tocview_2"><table cellspacing="0" cellpadding="0"><tr><td align="right">3.2.1&nbsp;</td><td><a href="The_Basic_Approach.html" class="tocviewlink" data-pltdoc="x">The Basic Approach</a></td></tr><tr><td align="right">3.2.2&nbsp;</td><td><a href="Reduction_to_Conventional_Functions.html" class="tocviewlink" data-pltdoc="x">Reduction to Conventional Functions</a></td></tr><tr><td align="right">3.2.3&nbsp;</td><td><a href="Why_Multiple_Continuations_are_Needed.html" class="tocviewlink" data-pltdoc="x">Why Multiple Continuations are Needed</a></td></tr><tr><td align="right">3.2.4&nbsp;</td><td><a href="OfPCFA.html" class="tocviewlink" data-pltdoc="x">Option for Passing Continuation Function Arguments</a></td></tr><tr><td align="right">3.2.5&nbsp;</td><td><a href="More_on_the_Function-Args_Pair_Option.html" class="tocviewlink" data-pltdoc="x">More on the Function-<wbr></wbr>Args Pair Option</a></td></tr><tr><td align="right">3.2.6&nbsp;</td><td><a href="Manual_Method.html" class="tocviewlink" data-pltdoc="x">Manual Method</a></td></tr><tr><td align="right">3.2.7&nbsp;</td><td><a href="" class="tocviewselflink" data-pltdoc="x">Eval With Scoped Variables</a></td></tr></table></div></div></div></div><div class="maincolumn"><div class="main"><div class="navsettop"><span class="navleft"><form class="searchform"><input class="searchbox" style="color: #888;" type="text" value="...search manuals..." title="Enter a search string to search the manuals" onkeypress="return DoSearchKey(event, this, &quot;6.1&quot;, &quot;../&quot;);" onfocus="this.style.color=&quot;black&quot;; this.style.textAlign=&quot;left&quot;; if (this.value == &quot;...search manuals...&quot;) this.value=&quot;&quot;;" onblur="if (this.value.match(/^ *$/)) { this.style.color=&quot;#888&quot;; this.style.textAlign=&quot;center&quot;; this.value=&quot;...search manuals...&quot;; }"/></form>&nbsp;&nbsp;<a href="../index.html" title="up to the documentation top" data-pltdoc="x" onclick="return GotoPLTRoot(&quot;6.1&quot;);">top</a></span><span class="navright">&nbsp;&nbsp;<a href="Manual_Method.html" title="backward to &quot;3.2.6 Manual Method&quot;" data-pltdoc="x">&larr; prev</a>&nbsp;&nbsp;<a href="Multiple_Execution_Path_Exits_Architecture.html" title="up to &quot;3.2 Multiple Execution Path Exits Architecture&quot;" data-pltdoc="x">up</a>&nbsp;&nbsp;<a href="Reference.html" title="forward to &quot;4 Reference&quot;" data-pltdoc="x">next &rarr;</a></span>&nbsp;</div><h5 x-source-module="(lib &quot;liquid/liquid.scrbl&quot;)" x-part-tag="&quot;Eval_With_Scoped_Variables&quot;">3.2.7<tt>&nbsp;</tt><a name="(part._.Eval_.With_.Scoped_.Variables)"></a>Eval With Scoped Variables</h5><p>Data passed to eval cannot refer to variables in scope.</p><p><table cellspacing="0" cellpadding="0"><tr><td><p><span class="stt">racket@function-lib.rkt&gt; (let([b 12][c 10]) (eval '(- 1 b)))</span></p></td></tr><tr><td><p><span class="stt">b: undefined;</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">cannot reference an identifier before its definition</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">in module: "/home/deep/liquid-lib/liquid/function-lib.rkt"</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">context...:</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt">/usr/share/racket/collects/racket/private/misc.rkt:87:7</span></p></td></tr></table></p><p>We can have eval return a lambda function to pass in the variables.</p><p><table cellspacing="0" cellpadding="0"><tr><td><p><span class="stt">racket@function-lib.rkt&gt; (let([b 12][c 10]) ((eval '(&#955;(u)(- 1 u))) b))</span></p></td></tr><tr><td><p><span class="stt">-11</span></p></td></tr></table></p><p>We Will not get to see the arguments for the continuation,  i.e. <span class="RktPn">(</span><span class="RktSym"><a href="http://download.racket-lang.org/docs/6.1/html/local-redirect/index.html?doc=reference&amp;rel=pairs.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._cdr%2529%2529&amp;version=6.1" class="RktValLink Sq" data-pltdoc="x">cdr</a></span><span class="stt"> </span><span class="RktSym">cont</span><span class="RktPn">)</span>
until run time, so we cannot build the eval with a call like this with a define-syntax function.</p><p>As a workaround, if we had a list of all the args and named outputs at compile time then a define-syntax
function could just add all of these to the call wrapper around the eval that creates the
the lambdas.  It does make sense to require that the named return values be declared.</p><p><table cellspacing="0" cellpadding="0"><tr><td><p><span class="stt">racket@function-lib.rkt&gt; (let([b 12][c 10]) ((eval '(&#955;(u v)(- 1 u))) b c))</span></p></td></tr><tr><td><p><span class="stt">-11</span></p></td></tr></table></p><p>Suppose we adopted the convention that all continuations are called with three arguments:
<span class="RktSym">args</span>, <span class="RktSym">conts</span>, <span class="RktSym">returns</span>.  Where arguments are the inputs to the consumer of
of the continuation,  conts were all the conts passed into the consumer, and returns are all the return
values created by the consumer function.  This would parallel the preamble
requirement for functions that use continuations (see previous section, Manual Method), which
also does manual parameter extraction.</p><p><table cellspacing="0" cellpadding="0"><tr><td><p><span class="stt">(define (a-cont args conts returns) ...)</span></p></td></tr></table></p><p>But there is a problem, with both this, and the indirect approach just above,  all of the return
values may not have been created at the time of the call to the continuation.  Rather <span class="RktSym">returns</span>
must be those guaranteed to be available to this specific continuation.</p><p>The inputs operands <span class="RktSym">args</span> and <span class="RktSym">conts</span> are only used in cases or attempted
recovery, and not typically in normal flow paths.</p><p>If we are going to specify <span class="RktSym">returns</span> on a per continuation basis, we better just specify
the whole prototype for the continuation.  At first take this comes full circle, but there is
a distinction that we now say it in the context of named argument lists via <span class="RktSym">mc:define</span>.</p><div class="navsetbottom"><span class="navleft"><form class="searchform"><input class="searchbox" style="color: #888;" type="text" value="...search manuals..." title="Enter a search string to search the manuals" onkeypress="return DoSearchKey(event, this, &quot;6.1&quot;, &quot;../&quot;);" onfocus="this.style.color=&quot;black&quot;; this.style.textAlign=&quot;left&quot;; if (this.value == &quot;...search manuals...&quot;) this.value=&quot;&quot;;" onblur="if (this.value.match(/^ *$/)) { this.style.color=&quot;#888&quot;; this.style.textAlign=&quot;center&quot;; this.value=&quot;...search manuals...&quot;; }"/></form>&nbsp;&nbsp;<a href="../index.html" title="up to the documentation top" data-pltdoc="x" onclick="return GotoPLTRoot(&quot;6.1&quot;);">top</a></span><span class="navright">&nbsp;&nbsp;<a href="Manual_Method.html" title="backward to &quot;3.2.6 Manual Method&quot;" data-pltdoc="x">&larr; prev</a>&nbsp;&nbsp;<a href="Multiple_Execution_Path_Exits_Architecture.html" title="up to &quot;3.2 Multiple Execution Path Exits Architecture&quot;" data-pltdoc="x">up</a>&nbsp;&nbsp;<a href="Reference.html" title="forward to &quot;4 Reference&quot;" data-pltdoc="x">next &rarr;</a></span>&nbsp;</div></div></div><div id="contextindicator">&nbsp;</div></body></html>