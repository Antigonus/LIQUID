<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"/><title>2.1.7&nbsp;Transaction Blocks and Threads</title><link rel="stylesheet" type="text/css" href="../scribble.css" title="default"/><link rel="stylesheet" type="text/css" href="../manual-style.css" title="default"/><link rel="stylesheet" type="text/css" href="../manual-racket.css" title="default"/><link rel="stylesheet" type="text/css" href="../manual-racket.css" title="default"/><link rel="stylesheet" type="text/css" href="../doc-site.css" title="default"/><script type="text/javascript" src="../scribble-common.js"></script><script type="text/javascript" src="../manual-racket.js"></script><script type="text/javascript" src="../manual-racket.js"></script><script type="text/javascript" src="../doc-site.js"></script><script type="text/javascript" src="file:///usr/share/doc/racket/local-redirect/local-redirect.js"></script><script type="text/javascript" src="file:///home/mordecai/.racket/6.1/doc/local-redirect/local-user-redirect.js"></script><!--[if IE 6]><style type="text/css">.SIEHidden { overflow: hidden; }</style><![endif]--></head><body id="doc-racket-lang-org"><div class="tocset"><div class="tocview"><div class="tocviewlist tocviewlisttopspace"><div class="tocviewtitle"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_0&quot;);">&#9658;</a></td><td></td><td><a href="index.html" class="tocviewlink" data-pltdoc="x">Racket Library Support for LIQUID</a></td></tr></table></div><div class="tocviewsublisttop" style="display: none;" id="tocview_0"><table cellspacing="0" cellpadding="0"><tr><td align="right">1&nbsp;</td><td><a href="About_Project_LIQUID.html" class="tocviewlink" data-pltdoc="x">About Project LIQUID</a></td></tr><tr><td align="right">2&nbsp;</td><td><a href="Concepts.html" class="tocviewselflink" data-pltdoc="x">Concepts</a></td></tr><tr><td align="right">3&nbsp;</td><td><a href="Architecture.html" class="tocviewlink" data-pltdoc="x">Architecture</a></td></tr><tr><td align="right">4&nbsp;</td><td><a href="Reference.html" class="tocviewlink" data-pltdoc="x">Reference</a></td></tr><tr><td align="right">5&nbsp;</td><td><a href="Examples.html" class="tocviewlink" data-pltdoc="x">Examples</a></td></tr><tr><td align="right">6&nbsp;</td><td><a href="db-lib-tests.html" class="tocviewlink" data-pltdoc="x">Running Tests</a></td></tr><tr><td align="right"></td><td><a href="doc-index.html" class="tocviewlink" data-pltdoc="x">Index</a></td></tr></table></div></div><div class="tocviewlist"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_1&quot;);">&#9658;</a></td><td>2&nbsp;</td><td><a href="Concepts.html" class="tocviewlink" data-pltdoc="x">Concepts</a></td></tr></table><div class="tocviewsublist" style="display: none;" id="tocview_1"><table cellspacing="0" cellpadding="0"><tr><td align="right">2.1&nbsp;</td><td><a href="db-lib-concepts.html" class="tocviewselflink" data-pltdoc="x">db-<wbr></wbr>lib</a></td></tr><tr><td align="right">2.2&nbsp;</td><td><a href="dataplex-concepts.html" class="tocviewlink" data-pltdoc="x">dataplex</a></td></tr><tr><td align="right">2.3&nbsp;</td><td><a href="parser-concepts.html" class="tocviewlink" data-pltdoc="x">parser</a></td></tr></table></div></div><div class="tocviewlist"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_2&quot;);">&#9660;</a></td><td>2.1&nbsp;</td><td><a href="db-lib-concepts.html" class="tocviewlink" data-pltdoc="x">db-<wbr></wbr>lib</a></td></tr></table><div class="tocviewsublistbottom" style="display: block;" id="tocview_2"><table cellspacing="0" cellpadding="0"><tr><td align="right">2.1.1&nbsp;</td><td><a href="Contexts.html" class="tocviewlink" data-pltdoc="x">Contexts</a></td></tr><tr><td align="right">2.1.2&nbsp;</td><td><a href="Function_Naming_Conventions.html" class="tocviewlink" data-pltdoc="x">Function Naming Conventions</a></td></tr><tr><td align="right">2.1.3&nbsp;</td><td><a href="Explicit_Key_Management.html" class="tocviewlink" data-pltdoc="x">Explicit Key Management</a></td></tr><tr><td align="right">2.1.4&nbsp;</td><td><a href="Simplified_Column_Type.html" class="tocviewlink" data-pltdoc="x">Simplified Column Type</a></td></tr><tr><td align="right">2.1.5&nbsp;</td><td><a href="A_Table_is_a_Two_Level_List.html" class="tocviewlink" data-pltdoc="x">A Table is a Two Level List</a></td></tr><tr><td align="right">2.1.6&nbsp;</td><td><a href="Pattern_Matching_for_Fetch.html" class="tocviewlink" data-pltdoc="x">Pattern Matching for Fetch</a></td></tr><tr><td align="right">2.1.7&nbsp;</td><td><a href="" class="tocviewselflink" data-pltdoc="x">Transaction Blocks and Threads</a></td></tr><tr><td align="right">2.1.8&nbsp;</td><td><a href="To-do.html" class="tocviewlink" data-pltdoc="x">To-<wbr></wbr>do</a></td></tr></table></div></div></div></div><div class="maincolumn"><div class="main"><div class="navsettop"><span class="navleft"><form class="searchform"><input class="searchbox" style="color: #888;" type="text" value="...search manuals..." title="Enter a search string to search the manuals" onkeypress="return DoSearchKey(event, this, &quot;6.1&quot;, &quot;../&quot;);" onfocus="this.style.color=&quot;black&quot;; this.style.textAlign=&quot;left&quot;; if (this.value == &quot;...search manuals...&quot;) this.value=&quot;&quot;;" onblur="if (this.value.match(/^ *$/)) { this.style.color=&quot;#888&quot;; this.style.textAlign=&quot;center&quot;; this.value=&quot;...search manuals...&quot;; }"/></form>&nbsp;&nbsp;<a href="../index.html" title="up to the documentation top" data-pltdoc="x" onclick="return GotoPLTRoot(&quot;6.1&quot;);">top</a></span><span class="navright">&nbsp;&nbsp;<a href="Pattern_Matching_for_Fetch.html" title="backward to &quot;2.1.6 Pattern Matching for Fetch&quot;" data-pltdoc="x">&larr; prev</a>&nbsp;&nbsp;<a href="db-lib-concepts.html" title="up to &quot;2.1 db-lib&quot;" data-pltdoc="x">up</a>&nbsp;&nbsp;<a href="To-do.html" title="forward to &quot;2.1.8 To-do&quot;" data-pltdoc="x">next &rarr;</a></span>&nbsp;</div><h5 x-source-module="(lib &quot;liquid/liquid.scrbl&quot;)" x-part-tag="&quot;Transaction_Blocks_and_Threads&quot;">2.1.7<tt>&nbsp;</tt><a name="(part._.Transaction_.Blocks_and_.Threads)"></a>Transaction Blocks and Threads</h5><p>If a given transaction in a given thread begins, and then another transaction in that same
   thread begins, the other transaction is nested within the given transaction.  The given
   transaction will not end until after the other transaction has ended, because
   transaction contexts require matched paraens.  This situation is considered normal
   nesting of transactions.</p><p>If a given transaction in a given thread begins, then a another transaction begins in another
   thread, we have a problem.  This is because the database operations within both transactions will
   interleave on the database connection.  If the other transaction completes first, it will appear
   to the database server that it is nested, and it will retire all of the interleaved transactions
   since it began, including the ones belonging to the given transaction.   If the given transaction
   completely first, the database will be confused because that is not proper nesting order.</p><p>Hence, we support nesting of transactions on the same thread but make simultaneous
   transactions on differing threads blocking.</p><p>This raises an unusual design issue for us, as we must recognize within a transaction
   context that a new transaction in the same thread should not block, but a new
   transaction in a different thread should. We make this distinction by giving a
   smemphore a thread owner property.  So a transaciton will say, "if the semphore is
   taken, but my thread is the owner of it, I get to go anyway."</p><p>It might be a better design option for some programs to avoid the complications of
   transactions between threads blocking, by simply using different database contexts on
   differing threads.  The database server then knows not to interleave the operations
   that arrive on different connections.  There would still be a race condition as to
   which transaction finishes first, but this same race condition occurs between all of
   the users of the database on all the various connections.</p><div class="navsetbottom"><span class="navleft"><form class="searchform"><input class="searchbox" style="color: #888;" type="text" value="...search manuals..." title="Enter a search string to search the manuals" onkeypress="return DoSearchKey(event, this, &quot;6.1&quot;, &quot;../&quot;);" onfocus="this.style.color=&quot;black&quot;; this.style.textAlign=&quot;left&quot;; if (this.value == &quot;...search manuals...&quot;) this.value=&quot;&quot;;" onblur="if (this.value.match(/^ *$/)) { this.style.color=&quot;#888&quot;; this.style.textAlign=&quot;center&quot;; this.value=&quot;...search manuals...&quot;; }"/></form>&nbsp;&nbsp;<a href="../index.html" title="up to the documentation top" data-pltdoc="x" onclick="return GotoPLTRoot(&quot;6.1&quot;);">top</a></span><span class="navright">&nbsp;&nbsp;<a href="Pattern_Matching_for_Fetch.html" title="backward to &quot;2.1.6 Pattern Matching for Fetch&quot;" data-pltdoc="x">&larr; prev</a>&nbsp;&nbsp;<a href="db-lib-concepts.html" title="up to &quot;2.1 db-lib&quot;" data-pltdoc="x">up</a>&nbsp;&nbsp;<a href="To-do.html" title="forward to &quot;2.1.8 To-do&quot;" data-pltdoc="x">next &rarr;</a></span>&nbsp;</div></div></div><div id="contextindicator">&nbsp;</div></body></html>